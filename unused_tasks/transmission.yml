---
- name: "copy Transmission configuration"
  template:
    src: "templates{{ item }}"
    dest: "{{ item }}"
  with_items:
    - "/var/docker/transmission/config/settings.json"

- name: "create Transmission container"
  docker_container:
    name: transmission
    image: linuxserver/transmission
    ports:
      - "51413:51413"
      - "9091:9091"
    volumes:
      - /var/docker/transmission/config:/config
      - /home/{{ user }}/downloads:/downloads
    env:
      PUID: '1080'
      PGID: '1080'
    restart_policy: always
    restart: yes
    labels:
      traefik.port: "9091"
      traefik.frontend.rule: "Host:transmission.romanpeters.nl"

- name: allow access to port 9091
  ufw:
    comment: Transmission
    rule: allow
    port: 9091
    src: "{{ item }}"
  with_items:
    - 10.10.10.0/24
    - 172.17.0.0/24
